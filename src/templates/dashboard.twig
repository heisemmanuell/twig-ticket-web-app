{% extends "base.twig" %}

{% block title %}Dashboard - Ticket Web App{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
  <header class="bg-white shadow">
    <div class="px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div class="flex items-center">
          <h1 class="text-2xl font-bold text-gray-900">Ticket Web App</h1>
        </div>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center space-x-6">
          <a 
            href="/dashboard" 
            class="text-gray-900 font-medium hover:text-indigo-600 transition-colors"
          >
            Dashboard
          </a>
          <a 
            href="/tickets" 
            class="text-gray-700 font-medium hover:text-indigo-600 transition-colors"
          >
            Tickets
          </a>
          <button
            onclick="handleLogout()"
            class="flex items-center gap-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-5 py-2.5 rounded-lg font-semibold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
          </button>
        </nav>

        <!-- Mobile menu button -->
        <button
          onclick="toggleMobileMenu()"
          class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
          id="mobile-menu-button"
        >
          <svg id="menu-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <svg id="close-icon" class="hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div id="mobile-menu" class="hidden md:hidden py-4 border-t border-gray-200 animate-fadeIn">
        <nav class="flex flex-col space-y-3">
          <a 
            href="/dashboard" 
            class="text-gray-900 font-medium hover:text-indigo-600 transition-colors py-2"
          >
            Dashboard
          </a>
          <a 
            href="/tickets" 
            class="text-gray-700 font-medium hover:text-indigo-600 transition-colors py-2"
          >
            Tickets
          </a>
          <div class="py-2 border-t border-gray-200">                
            <button
              onclick="handleLogout()"
              class="flex items-center justify-center gap-2 w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-5 py-2.5 rounded-lg font-semibold transition-all duration-300 shadow-md"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Logout
            </button>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="py-6 sm:px-6 lg:px-8">
    <div class="px-4 py-6 sm:px-0">
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">Dashboard</h2>
        <span id="welcome-message" class="text-gray-700">Welcome back! ðŸ‘‹</span>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
        
        <div class="bg-white overflow-hidden shadow-lg rounded-xl border border-gray-200 pt-5 pb-5">
          <div class="p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-gray-400 rounded-lg flex items-center justify-center">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                  </svg>
                </div>
              </div>
              <div class="ml-4 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Total Tickets</dt>
                  <dd class="text-2xl font-bold text-gray-900">{{ stats.total }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow-lg rounded-xl border border-gray-200 pt-5 pb-5">
          <div class="p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-green-400 rounded-lg flex items-center justify-center">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                </div>
              </div>
              <div class="ml-4 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Open</dt>
                  <dd class="text-2xl font-bold text-green-600">{{ stats.open }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow-lg rounded-xl border border-gray-200 pt-5 pb-5">
          <div class="p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-amber-400 rounded-lg flex items-center justify-center">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                </div>
              </div>
              <div class="ml-4 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">In Progress</dt>
                  <dd class="text-2xl font-bold text-amber-600">{{ stats.inProgress }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow-lg rounded-xl border border-gray-200 pt-5 pb-5">
          <div class="p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 bg-gray-400 rounded-lg flex items-center justify-center">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </div>
              </div>
              <div class="ml-4 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Closed</dt>
                  <dd class="text-2xl font-bold text-gray-600">{{ stats.closed }}</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr class="mb-5 border-black">

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 col-span-full">
          Quick Actions
        </h2>
        
          <a href="/tickets"
          class="bg-white hover:bg-gray-200 transition shadow-lg rounded-xl border border-gray-200 p-6 flex items-start gap-4 no-underline"
        >
          <div class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center flex-shrink-0">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-1">
              Create New Ticket
            </h3>
            <p class="text-gray-600 text-sm">
              Set up a new ticket or request
            </p>
          </div>
        </a>
        
          <a href="/tickets"
          class="bg-white hover:bg-gray-200 transition shadow-lg rounded-xl border border-gray-200 p-6 flex items-start gap-4 no-underline"
        >
          <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-1">
              Manage Tickets
            </h3>
            <p class="text-gray-600 text-sm">
              View and manage all your ticket sales
            </p>
          </div>
        </a>
      </div>
    </div>
  </main>
</div>

<script>
  function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    
    mobileMenu.classList.toggle('hidden');
    menuIcon.classList.toggle('hidden');
    closeIcon.classList.toggle('hidden');
  }

  function handleLogout() {
    localStorage.removeItem('ticketapp_session');
    window.location.href = '/';
  }

  // Load tickets data
  function loadDashboardData() {
    const session = localStorage.getItem('ticketapp_session');
    if (!session) {
      window.location.href = '/auth/login';
      return;
    }

    try {
      const user = JSON.parse(session);

      // Update welcome message
      const welcomeElement = document.getElementById('welcome-message');
      if (welcomeElement) {
        welcomeElement.textContent = `Welcome back, ${user.name}! ðŸ‘‹`;
      }

      const tickets = JSON.parse(localStorage.getItem(`tickets_${user.id}`) || '[]');

      // Calculate stats
      const stats = {
        total: tickets.length,
        open: tickets.filter(t => t.status === 'open').length,
        inProgress: tickets.filter(t => t.status === 'in_progress').length,
        closed: tickets.filter(t => t.status === 'closed').length
      };

      // Update the DOM with stats
      document.querySelector('dd.text-2xl.font-bold.text-gray-900').textContent = stats.total;
      document.querySelector('dd.text-2xl.font-bold.text-green-600').textContent = stats.open;
      document.querySelector('dd.text-2xl.font-bold.text-amber-600').textContent = stats.inProgress;
      document.querySelector('dd.text-2xl.font-bold.text-gray-600').textContent = stats.closed;

    } catch (error) {
      console.error('Error loading dashboard data:', error);
    }
  }

  // Check authentication on page load
  document.addEventListener('DOMContentLoaded', function() {
    const session = localStorage.getItem('ticketapp_session');
    if (!session) {
      window.location.href = '/auth/login';
      return;
    }
    loadDashboardData();
  });
</script>

<style>
  .no-underline {
    text-decoration: none;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.5s ease-out;
  }
</style>
{% endblock %}